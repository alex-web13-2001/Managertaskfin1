# Тестирование системы приглашений

## Как протестировать отправку приглашений

1. **Войдите в систему** используя существующий аккаунт или создайте новый
2. **Откройте проект** из списка проектов
3. **Нажмите на кнопку "Участники"** в верхней части детального вида проекта
4. **Откройте консоль браузера** (F12) для просмотра логов

## Что проверить

### При отправке приглашения:

1. Введите email в поле "Email участника"
2. Выберите роль (по умолчанию "Участник")
3. Нажмите кнопку "Пригласить"

### Ожидаемое поведение:

✅ **Успешная отправка:**
- Появится уведомление "Приглашение отправлено"
- Автоматически переключится на вкладку "Приглашения"
- Новое приглашение появится в списке со статусом "Ожидает"
- Поле email очистится

❌ **Возможные ошибки:**

1. **"Введите корректный email адрес"** - email не прошел валидацию
2. **"Пользователь уже является участником проекта"** - пользователь с таким email уже в проекте
3. **"Приглашение уже отправлено на этот email"** - есть активное приглашение
4. **"Необходима авторизация"** - нет access_token в localStorage
5. **"Ошибка отправки приглашения"** - ошибка сервера

## Логи в консоли

### Frontend (браузер):
```
Sending invitation for: test@example.com role: member
Invitation response status: 200
Invitation created: { invitation: {...} }
```

### Backend (Supabase Edge Function):
```
Creating invitation for project abc-123 to email test@example.com with role member by user user-456
Found 0 existing invitations for project abc-123
Successfully created invitation inv-1234567890 for test@example.com
```

## Проверка в базе данных

После отправки приглашения, данные сохраняются в KV store:
- Ключ: `project:{projectId}:invitations`
- Значение: массив объектов приглашений

Каждое приглашение содержит:
- `id` - уникальный идентификатор
- `email` - email приглашенного
- `role` - роль (owner/collaborator/member/viewer)
- `status` - статус (pending/expired/revoked/accepted)
- `sentDate` - дата отправки (ISO string)
- `sentBy` - ID пользователя, отправившего приглашение
- `link` - ссылка для принятия приглашения

## Дополнительные функции

### Копирование ссылки приглашения:
- Нажмите кнопку "Скопировать" рядом с приглашением
- Ссылка скопируется в буфер обмена

### Отзыв приглашения:
- Нажмите кнопку "Отозвать" рядом с приглашением
- Подтвердите действие в диалоговом окне
- Статус изменится на "Отозвано"

### Повторная отправка истекшего приглашения:
- Нажмите кнопку "Отправить снова" рядом с истекшим приглашением
- Будет создана новая ссылка и обновлена дата отправки
- Статус изменится на "Ожидает"

## Устранение неполадок

### Если приглашения не отправляются:

1. **Проверьте access_token:**
   Откройте консоль и выполните:
   ```javascript
   // Проверка сессии Supabase
   const { data: { session } } = await window.supabase.auth.getSession();
   console.log('Session:', session);
   console.log('Access token:', session?.access_token);
   ```
   Должен возвращать валидный JWT токен. Если токена нет, выполните повторный вход.

2. **Проверьте сетевые запросы** в DevTools (вкладка Network):
   - Должен быть POST запрос к `/make-server-d9879966/projects/{id}/invitations`
   - Статус ответа должен быть 200 OK

3. **Проверьте логи сервера** в Supabase Dashboard:
   - Functions → server → Logs
   - Должны быть сообщения о создании приглашения

4. **Проверьте формат данных:**
   ```javascript
   // Тело запроса должно содержать:
   {
     "email": "test@example.com",
     "role": "member"
   }
   ```

### Если приглашения не появляются в списке:

1. **Обновите вкладку** - переключитесь между вкладками "Участники" и "Приглашения"
2. **Закройте и откройте модальное окно** заново
3. **Проверьте console.log** на количество загруженных приглашений

## Известные ограничения

- В demo-режиме приглашения сохраняются только в памяти сессии
- Email уведомления не отправляются (требуется настройка email сервера)
- Ссылки приглашений генерируются случайно и не имеют функциональности принятия
