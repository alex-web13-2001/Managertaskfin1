# üñºÔ∏è –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∫–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Supabase Storage.

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### Backend (Supabase Edge Function)

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Storage** (`/supabase/functions/server/index.tsx`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ bucket `make-d9879966-avatars` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞: 2MB
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: JPG, PNG, GIF, WEBP

2. **API Endpoints**:
   - `POST /make-server-d9879966/auth/avatar` - –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
   - `DELETE /make-server-d9879966/auth/avatar` - —É–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏
   - `PUT /make-server-d9879966/auth/profile` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ avatarUrl

3. **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–π
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è signed URL (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 1 –≥–æ–¥)
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è avatarUrl —Å Supabase Auth metadata

### Frontend

1. **API Client** (`/utils/supabase/client.tsx`)
   - `uploadAvatar(file: File)` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
   - `deleteAvatar()` - —É–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

2. **App Context** (`/contexts/app-context.tsx`)
   - `uploadAvatar` - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - `deleteAvatar` - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. **Profile View** (`/components/profile-view.tsx`)
   - Input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (—Å–∫—Ä—ã—Ç—ã–π)
   - –ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ" —Å –∏–∫–æ–Ω–∫–æ–π Upload
   - –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∫–∞)
   - –ü—Ä–µ–≤—å—é —Ç–µ–∫—É—â–µ–π –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª—ã
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞

4. **Header** (`/components/header.tsx`)
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –∞–≤–∞—Ç–∞—Ä–∫–∏
   - Fallback –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª—ã –µ—Å–ª–∏ –Ω–µ—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª "–ü—Ä–æ—Ñ–∏–ª—å" —á–µ—Ä–µ–∑ –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–∞–π–¥–±–∞—Ä
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ"
4. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, GIF –∏–ª–∏ WEBP, –¥–æ 2MB)
5. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è "–ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω"
6. –ê–≤–∞—Ç–∞—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏ –≤ header

### 2. –ó–∞–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏

1. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –Ω–∞–∂–º–∏—Ç–µ "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ" —Å–Ω–æ–≤–∞
2. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. –°—Ç–∞—Ä–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—Å—è
4. –ù–æ–≤–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –≤–µ–∑–¥–µ

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏

1. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å –∏–∫–æ–Ω–∫–æ–π –∫–æ—Ä–∑–∏–Ω—ã
2. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è "–ê–≤–∞—Ç–∞—Ä —É–¥–∞–ª–µ–Ω"
3. –í–º–µ—Å—Ç–æ –∞–≤–∞—Ç–∞—Ä–∫–∏ –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª—ã

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:
- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –±–æ–ª—å—à–µ 2MB
- –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, PDF)
- –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 5. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä–∫—É
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –ê–≤–∞—Ç–∞—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
4. –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
5. –ê–≤–∞—Ç–∞—Ä–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```
Supabase Storage Bucket: make-d9879966-avatars
‚îú‚îÄ‚îÄ {userId}/
‚îÇ   ‚îî‚îÄ‚îÄ avatar-{timestamp}.{ext}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π (–Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π)
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ signed URLs
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω—ã
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ –∏ —Ä–∞–∑–º–µ—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```typescript
User {
  id: string;
  email: string;
  name: string;
  avatarUrl?: string;      // Signed URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
  avatarPath?: string;     // –ü—É—Ç—å –≤ Storage (–¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è)
  createdAt?: string;
}
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: –º–∞–∫—Å–∏–º—É–º 2MB
2. **–§–æ—Ä–º–∞—Ç—ã**: JPG, PNG, GIF, WEBP
3. **Signed URL**: –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 1 –≥–æ–¥ (–∑–∞—Ç–µ–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)
4. **–û–¥–∏–Ω —Ñ–∞–π–ª –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–π –∞–≤–∞—Ç–∞—Ä–∫–∏ —Å—Ç–∞—Ä–∞—è —É–¥–∞–ª—è–µ—Ç—Å—è

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ö—Ä–æ–ø–∏–Ω–≥ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- [ ] Drag & drop –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ signed URL –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SVG –∞–≤–∞—Ç–∞—Ä–æ–∫
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∞–≤–∞—Ç–∞—Ä–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function –≤ Supabase Dashboard
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket –±—ã–ª —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Storage
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
