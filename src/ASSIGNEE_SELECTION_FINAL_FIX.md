# –§–∏–Ω–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏ –≤—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ —Å —Ä–æ–ª—å—é "member") –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –°–†–ê–ó–£ —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ "–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ". –ü—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

## –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ useMemo

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
const availableMembers = React.useMemo(() => {
  // ... –ª–æ–≥–∏–∫–∞
  if (assigneeId && !membersMap.has(assigneeId)) {
    // –î–æ–±–∞–≤–ª—è–µ–º assigneeId –≤ —Å–ø–∏—Å–æ–∫
  }
  return result;
}, [projectId, selectedProject, teamMembers, existingTask, assigneeId]); // assigneeId –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö!
```

**–¶–∏–∫–ª:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ‚Üí `setAssigneeId()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
2. `assigneeId` –º–µ–Ω—è–µ—Ç—Å—è ‚Üí `availableMembers` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è (–∏–∑-–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
3. `availableMembers` –º–µ–Ω—è–µ—Ç—Å—è ‚Üí React Select –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ—Ç—Å—è
4. –ü—Ä–∏ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ –º–æ–∂–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –Ω–æ–≤–æ–º —Å–ø–∏—Å–∫–µ
5. –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è

### 2. –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ selectedProject

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
const selectedProject = projectId === 'personal' 
  ? { id: 'personal', name: '–õ–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏', color: 'gray' }  // –ö–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç!
  : projects.find((p) => p.id === projectId);
```

–ö–∞–∂–¥—ã–π —Ä–µ–Ω–¥–µ—Ä —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è –ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –ø–µ—Ä–µ—Å—á–µ—Ç `availableMembers`.

### 3. –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ useEffect

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
React.useEffect(() => {
  if (prevProjectIdRef.current !== projectId) {
    // ... –ª–æ–≥–∏–∫–∞
  }
}, [projectId, currentUser, taskId, assigneeId]); // assigneeId –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö!
```

–ö–æ–≥–¥–∞ `assigneeId` –º–µ–Ω—è–ª—Å—è, effect —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª —Å–Ω–æ–≤–∞, —á—Ç–æ –º–æ–≥–ª–æ –≤—ã–∑–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.

### 4. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** useEffect –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—ã –∏–∑ existingTask —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è, –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—è –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–Ω–æ–≤–æ.

## –†–µ—à–µ–Ω–∏–µ

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ availableMembers –Ω–∞ –¥–≤–∞ —Å–ø–∏—Å–∫–∞

**–ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π):**
```javascript
const availableMembers = React.useMemo(() => {
  // –°—Ç—Ä–æ–∏–º —Å–ø–∏—Å–æ–∫ —Ç–æ–ª—å–∫–æ –∏–∑ project.members –∏ teamMembers
  // –ù–ï –≤–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π assigneeId
  return result;
}, [projectId, selectedProject, teamMembers, existingTask]); // –ë–ï–ó assigneeId!
```

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–≤–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π assigneeId):**
```javascript
const availableMembersWithCurrent = React.useMemo(() => {
  if (!assigneeId || projectId === 'personal') {
    return availableMembers;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ assigneeId –≤ —Å–ø–∏—Å–∫–µ
  const memberExists = availableMembers.some(m => m.id === assigneeId);
  if (memberExists) {
    return availableMembers;
  }
  
  // –ï—Å–ª–∏ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ
  const projectMember = selectedProject?.members?.find(...);
  if (projectMember) {
    return [...availableMembers, tempMember];
  }
  
  return availableMembers;
}, [availableMembers, assigneeId, projectId, selectedProject, teamMembers]);
```

–¢–µ–ø–µ—Ä—å —Ü–∏–∫–ª —Ä–∞–∑–æ—Ä–≤–∞–Ω:
- `availableMembers` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞/–∫–æ–º–∞–Ω–¥—ã
- `availableMembersWithCurrent` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `assigneeId`, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- Select –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `availableMembersWithCurrent`, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

### 2. –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è selectedProject

```javascript
const selectedProject = React.useMemo(() => {
  return projectId === 'personal' 
    ? { id: 'personal', name: '–õ–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏', color: 'gray' }
    : projects.find((p) => p.id === projectId);
}, [projectId, projects]);
```

–¢–µ–ø–µ—Ä—å –æ–±—ä–µ–∫—Ç –¥–ª—è –ª–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `projectId`.

### 3. –£–¥–∞–ª–µ–Ω–∏–µ assigneeId –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π useEffect

```javascript
React.useEffect(() => {
  if (prevProjectIdRef.current !== projectId) {
    // ... –ª–æ–≥–∏–∫–∞
  }
}, [projectId, currentUser, taskId]); // –ë–ï–ó assigneeId!
```

### 4. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã

```javascript
const formInitializedRef = React.useRef<string | null>(null);

React.useEffect(() => {
  const currentTaskId = existingTask?.id || 'create';
  const shouldInitialize = formInitializedRef.current !== currentTaskId || !open;
  
  if (existingTask && shouldInitialize) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ä–º—É —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
    setTitle(existingTask.title || '');
    // ...
    formInitializedRef.current = currentTaskId;
  }
}, [existingTask, isCreateMode, initialProject, open]);
```

### 5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤ Select

```javascript
<Select 
  value={(() => {
    if (!assigneeId) return 'unassigned';
    const memberExists = availableMembersWithCurrent.some(m => m.id === assigneeId);
    if (!memberExists) {
      console.warn('‚ö†Ô∏è –í—ã–±—Ä–∞–Ω–Ω—ã–π assigneeId –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return 'unassigned';
    }
    return assigneeId;
  })()} 
  onValueChange={(value) => {
    const newValue = value === 'unassigned' ? '' : value;
    setAssigneeId(newValue);
  }}
>
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- –ü—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ `availableMembers`
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `assigneeId`
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `projectId`

### –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

–ï—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫ –µ—Å—Ç—å –≤ `project.members`, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `teamMembers`, —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç:

```javascript
if (projectMember) {
  const tempMember = {
    id: memberId,
    name: projectMember.name || projectMember.email,
    email: projectMember.email,
    avatarUrl: projectMember.avatar || projectMember.avatarUrl,
  };
  return [...availableMembers, tempMember];
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ë–æ–ª—å—à–µ –Ω–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤**
‚úÖ **–í—ã–±–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏**
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (member, collaborator, viewer)**
‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ Select –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞**
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã**

## –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å —Ä–æ–ª—å—é "member"
2. –£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
3. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –≤ –ø—Ä–æ–µ–∫—Ç–µ
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å —Ä–æ–ª—å—é "member" –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
6. ‚úÖ –í—ã–±–æ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è (–Ω–µ —Å–±—Ä–æ—Å–∏—Ç—å—Å—è)
7. –ó–∞–∫—Ä–æ–π—Ç–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
8. –°–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
9. ‚úÖ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º
10. –ò–∑–º–µ–Ω–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –Ω–∞ –¥—Ä—É–≥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
11. ‚úÖ –ù–æ–≤—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `/components/task-modal.tsx` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö –ª–æ–≥–æ–≤:

- `üîÑ TaskModal render:` - –∫–∞–∂–¥—ã–π —Ä–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- `üîç availableMembers –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω` - –ø–µ—Ä–µ—Å—á–µ—Ç —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `üë§ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- `‚ö†Ô∏è Current assigneeId ... not in availableMembers` - —É—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–æ–≤–æ–º —Å–ø–∏—Å–∫–µ
- `‚ö†Ô∏è –í—ã–±—Ä–∞–Ω–Ω—ã–π assigneeId –Ω–µ –Ω–∞–π–¥–µ–Ω` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–æ
