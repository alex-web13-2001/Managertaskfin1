# Чек-лист исправления системы архивирования

## Проблема
Раздел "Проекты" с фильтром "Архивированные" и раздел "Архив" (по ссылке из профиля) показывали разные данные.

## Причина
- В `projects-view.tsx` использовалось поле `project.status === 'archived'` (старая логика)
- В `archive-view.tsx` использовалось новое поле `project.archived === true`
- Это были разные источники данных!

## Что исправлено

### 1. Backend (`/supabase/functions/server/index.tsx`)
✅ GET `/projects` теперь фильтрует архивные проекты: `.filter((p: any) => !p.archived)`
✅ Архивные проекты доступны только через GET `/projects/archived`

### 2. Context (`/contexts/app-context.tsx`)
✅ `fetchProjects()` фильтрует архивные: `const activeProjects = fetchedProjects.filter(p => !p.archived)`
✅ Тип `Project` содержит поля `archived?: boolean` и `archivedAt?: string`
✅ Отдельный стейт `archivedProjects` для хранения архивных проектов
✅ Метод `fetchArchivedProjects()` для загрузки архивных проектов

### 3. Frontend (`/components/projects-view.tsx`)
✅ Убран фильтр "Архивированные" - теперь только "Все проекты", "Мои", "Приглашённые"
✅ Удалена переменная состояния `statusFilter`
✅ Обновлена логика `isArchived`: `!!project.archived` вместо `project.status === 'archived'`
✅ Фильтрация проектов теперь только по `typeFilter` (mine/invited/all)
✅ Бейдж "Архив" не показывается, так как архивные проекты отфильтрованы

### 4. Archive View (`/components/archive-view.tsx`)
✅ Использует `fetchArchivedProjects()` из контекста
✅ Отображает только архивные проекты из `archivedProjects` стейта
✅ Кнопки "Восстановить" и "Удалить навсегда"

## Логика работы после исправлений

```
┌─────────────────────┐
│  GET /projects      │ → Только АКТИВНЫЕ проекты (archived !== true)
└─────────────────────┘
          ↓
┌─────────────────────┐
│  projects (state)   │ → Список активных проектов в Context
└─────────────────────┘
          ↓
┌─────────────────────┐
│  ProjectsView       │ → Показывает активные проекты
└─────────────────────┘

┌─────────────────────┐
│ GET /projects/      │ → Только АРХИВНЫЕ проекты (archived === true)
│     archived        │
└─────────────────────┘
          ↓
┌─────────────────────┐
│archivedProjects     │ → Список архивных проектов в Context
│     (state)         │
└─────────────────────┘
          ↓
┌─────────────────────┐
│  ArchiveView        │ → Показывает архивные проекты
└─────────────────────┘
```

## Проверка

### ✅ Раздел "Проекты"
- Не показывает архивные проекты
- Фильтры: "Все проекты", "Мои", "Приглашённые"
- Бейдж "Архив" не отображается на карточках
- Кнопка "В архив" доступна только владельцу

### ✅ Раздел "Архив" (Profile → Архив)
- Показывает только архивные проекты
- Кнопка "Восстановить" возвращает проект в активные
- Кнопка "Удалить" удаляет проект навсегда (с подтверждением)

### ✅ Backend API
- `GET /projects` возвращает только активные проекты
- `GET /projects/archived` возвращает только архивные проекты
- `POST /projects/:id/archive` архивирует проект (только владелец)
- `POST /projects/:id/restore` восстанавливает проект (только владелец)
- `DELETE /projects/:id` удаляет проект навсегда (только из архива)

## Тестирование

1. **Создайте проект** → Он должен появиться в разделе "Проекты"
2. **Отправьте проект в архив** (⋮ → В архив) → Проект исчезает из списка "Проекты"
3. **Перейдите в Архив** (Avatar → Архив) → Проект должен быть в архиве
4. **Восстановите проект** → Проект возвращается в "Проекты"
5. **Снова отправьте в архив** → Проект в архиве
6. **Удалите из архива** → Проект удалён навсегда

## Ожидаемый результат

✅ Раздел "Проекты" и раздел "Архив" показывают РАЗНЫЕ данные
✅ В "Проектах" - только активные проекты
✅ В "Архиве" - только архивные проекты
✅ Никаких дубликатов и несоответствий
✅ Фильтр "Архивированные" удалён из раздела "Проекты"
